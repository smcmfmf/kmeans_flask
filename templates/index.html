<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-means ë°ì´í„° ë¶„ì„ê¸°</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background-color: #f4f4f9; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .control-panel { padding: 20px; background: #eef2f5; border-radius: 8px; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        input[type="file"], input[type="number"] { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; background: #fff; }
        
        /* ë¼ë””ì˜¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .radio-group { display: flex; gap: 20px; background: white; padding: 10px; border-radius: 4px; border: 1px solid #ccc; }
        .radio-item { display: flex; align-items: center; }
        .radio-item input { margin-right: 8px; width: auto; }
        
        button { width: 100%; background-color: #2196F3; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px;}
        button:hover { background-color: #1976D2; }

        /* ë¯¸ë¦¬ë³´ê¸° í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        #preview-area { margin-top: 10px; overflow-x: auto; display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 0.9em; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .preview-label { font-size: 0.9em; color: #666; margin-bottom: 5px; }

        .result-section { text-align: center; margin-top: 30px; border-top: 2px dashed #ccc; padding-top: 20px; }
        .result-img { max-width: 100%; border: 1px solid #ddd; border-radius: 4px; }
        .error { color: #d32f2f; background: #ffcdd2; padding: 10px; border-radius: 4px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Advanced K-means ë¶„ì„ê¸°</h1>

        {% if error_msg %}
        <div class="error">âš ï¸ ì˜¤ë¥˜ ë°œìƒ: {{ error_msg }}</div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" class="control-panel">
            <div class="form-group">
                <label for="file">1. CSV íŒŒì¼ ì—…ë¡œë“œ (ìƒìœ„ 5í–‰ ë¯¸ë¦¬ë³´ê¸°):</label>
                <input type="file" name="file" id="file" accept=".csv" required>
                
                <div id="preview-area">
                    <div class="preview-label">ğŸ“„ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (ìƒìœ„ 5ê°œ í–‰):</div>
                    <table id="preview-table"></table>
                </div>
            </div>
            
            <div class="form-group">
                <label>2. ë¶„ì„(ì „ì²˜ë¦¬) ë°©ë²• ì„ íƒ:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="method_std" name="method" value="std" checked>
                        <label for="method_std" style="margin:0; font-weight:normal;">í‘œì¤€í™” (ëª¨ë“  íŠ¹ì„± ë°˜ì˜)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="method_pca" name="method" value="pca">
                        <label for="method_pca" style="margin:0; font-weight:normal;">PCA (ì£¼ì„±ë¶„ ì••ì¶•)</label>
                    </div>
                </div>
                <small style="color: gray; display:block; margin-top:5px;">
                    * <strong>í‘œì¤€í™”:</strong> ìˆëŠ” ê·¸ëŒ€ë¡œì˜ ë°ì´í„°ë¥¼ ì •ê·œí™”í•˜ì—¬ ë¶„ì„í•©ë‹ˆë‹¤.<br>
                    * <strong>PCA:</strong> ë°ì´í„°ë¥¼ 2ê°œì˜ í•µì‹¬ ì¶•ìœ¼ë¡œ ì••ì¶•í•˜ì—¬ ë¶„ì„í•©ë‹ˆë‹¤ (ë…¸ì´ì¦ˆ ì œê±° íš¨ê³¼).
                </small>
            </div>

            <div class="form-group">
                <label for="k_value">3. í´ëŸ¬ìŠ¤í„° ê°œìˆ˜ (K):</label>
                <input type="number" name="k_value" id="k_value" min="2" max="10" value="3" required>
            </div>

            <button type="submit">ë¶„ì„ ì‹œì‘</button>
        </form>
        
        {% if plot_url %}
        <div class="result-section">
            <h2>ğŸ“ˆ ë¶„ì„ ê²°ê³¼</h2>
            <img src="data:image/png;base64,{{ plot_url }}" alt="Clustering Result" class="result-img">
            <p>
                ì„ íƒí•œ ë°©ì‹: <strong>{{ method_text }}</strong><br>
                ë°ì´í„°ê°€ <strong>{{ k_value }}</strong>ê°œ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.
            </p>
        </div>
        {% endif %}
    </div>

    <script>
        document.getElementById('file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const rows = text.split('\n');
                const table = document.getElementById('preview-table');
                table.innerHTML = '';

                const limit = Math.min(rows.length, 6);
                
                for (let i = 0; i < limit; i++) {
                    const row = rows[i].trim();
                    if (row) {
                        const tr = document.createElement('tr');
                        const cells = row.split(',');
                        
                        cells.forEach(cell => {
                            const el = i === 0 ? 'th' : 'td';
                            const td = document.createElement(el);
                            td.textContent = cell;
                            tr.appendChild(td);
                        });
                        table.appendChild(tr);
                    }
                }
                document.getElementById('preview-area').style.display = 'block';
            };
            reader.readAsText(file, 'UTF-8');
        });
    </script>
</body>
</html>